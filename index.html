
                cellContents.push({ key: parseInt(cell.dataset.key), symbol: shuffledSymbols[index] });
                cell.textContent = '';
            });

            toggleButton.style.display = 'inline-block';
            toggleButton.textContent = '顯示圖案';
            symbolsVisible = false;
            nextSymbol();
        }

        function nextSymbol() {
            const activeCells = cells.filter(cell => !selectedCells.includes(parseInt(cell.dataset.key)));
            const randomIndex = Math.floor(Math.random() * activeCells.length);
            currentKey = parseInt(activeCells[randomIndex].dataset.key);
            target.textContent = cellContents.find(cell => cell.key === currentKey).symbol;
        }

        function checkInput(key) {
            if (parseInt(key) === currentKey) {
                score++;
                scoreDisplay.textContent = `得分: ${score}`;
                nextSymbol();
            } else {
                gameOver();
            }
        }

        function handleCellClick(event) {
            const key = parseInt(event.target.dataset.key);
            checkInput(key);
        }

        function toggleSymbols() {
            symbolsVisible = !symbolsVisible;
            toggleButton.textContent = symbolsVisible ? '隱藏圖案' : '顯示圖案';
            const activeCells = cells.filter(cell => !selectedCells.includes(parseInt(cell.dataset.key)));
            if (symbolsVisible) {
                activeCells.forEach(cell => {
                    const content = cellContents.find(c => c.key === parseInt(cell.dataset.key));
                    cell.textContent = content ? content.symbol : '';
                });
            } else {
                activeCells.forEach(cell => cell.textContent = '');
            }
        }

        function gameOver() {
            alert(`遊戲結束！最終得分: ${score}`);
            target.textContent = '';
            cells.forEach(cell => cell.textContent = '');
            startButton.style.display = 'inline-block';
            toggleButton.style.display = 'none';
            createGrid();
        }

        function startGame() {
            score = 0;
            scoreDisplay.textContent = `得分: ${score}`;
            startButton.style.display = 'none';
            initializeGame();
        }

        startButton.addEventListener('click', startGame);
        toggleButton.addEventListener('click', toggleSymbols);

        // 修改鍵盤事件監聽
        document.addEventListener('keydown', (e) => {
            if (startButton.style.display !== 'none') { // 遊戲未開始
                if (e.key === 'Enter' || e.key === '0') {
                    startGame(); // Enter 或 0 開始遊戲
                } else if (e.key >= '1' && e.key <= '9') {
                    toggleCell(parseInt(e.key)); // 1-9 切換格子
                }
            } else { // 遊戲進行中
                if (e.key === 'Enter' || e.key === '0') {
                    toggleSymbols(); // Enter 或 0 顯示/隱藏圖案
                } else if (e.key >= '1' && e.key <= '9') {
                    checkInput(e.key); // 1-9 用於回答
                }
            }
        });

        createGrid();
    </script>
</body>
</html>
